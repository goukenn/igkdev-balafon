#!/usr/bin/env php
<?php
// @author: C.A.D. BONDJE DOUE
// @file : file extension
// @description: balafon command line args
// @version: 1.2
require_once(__DIR__ . "/../igk_framework.php");
require_once(IGK_LIB_CLASSES_DIR."/Resources/R.php");
require_once(IGK_LIB_CLASSES_DIR."/System/Console/App.php");
require_once(IGK_LIB_CLASSES_DIR."/System/Console/BalafonApplication.php");
require_once(IGK_LIB_CLASSES_DIR."/System/Console/Logger.php");
require_once(IGK_LIB_CLASSES_DIR."/System/Console/ConsoleLogger.php");
require_once(IGK_LIB_CLASSES_DIR."/IGKApplicationFactory.php");
require_once(IGK_LIB_CLASSES_DIR."/IGKEnvironment.php");


 
// + | ---------------------------------------------------------------------------------- 
// + | register application type
// + |
IGKApplicationFactory::Register("balafon", \IGK\System\Console\BalafonApplication::class);

/**
 * @var \IGK\System\Console\BalafonApplication $app 
 */
$app = IGKApplicationLoader::Boot("balafon");

$command = $app->getPrimaryCommand();
 
 
//-----------------------------------------------------------------------------
// | handle default
// |

if (isset($argv[1]) && $argv[1]=="--init"){
    //-----------------------------------------------------------------------------
    // | initialize balafon configuration 
    // |
    $fc = $command["--init"][0];
    $carg = [];
    if (in_array("--noconfig", $argv)){
        $carg["--noconfig"] = 1;
    }
    if (in_array("--force", $argv)){
        $carg["--force"] = 1;
    }
    if (in_array("--primary", $argv)){
        $carg["--primary"] = 1;
    }
    $command["options"] = (object)$carg;
    $command["argv"] = $argv;
    $fc([], $command); 
    exit(0); 
}
if (in_array("--debug", $argv)){
    $fc = $command["--debug"][0];
    $fc([], $command);
} 

 

//--------------------------------------------------------------------------------
// | Run the application
// |
$app->command = $command;
// | run application
// |
$status = $app->run(__FILE__, false);
//--------------------------------------------------------------------------------
// | finish with status code
// |
exit($status);
